# Ğ¢ĞµÑÑ‚Ñ‹ Ğ½Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ñ‹  Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ĞµĞµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ñ… ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸ĞµĞ²:
# Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµÑ‚ĞµĞ»ÑŒ Ğ´ĞµĞ»Ğ°ĞµÑ‚ post Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ Ğ´ĞµĞ»Ğ°ĞµÑ‚ get ÑÑ‚Ğ¸Ñ… Ğ¶Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… - ĞºĞ°Ğº Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ğ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
# Ğº ÑĞ¾Ğ¶Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ñ Ğ½Ğµ Ğ·Ğ½Ğ°Ñ ĞºĞ°ĞºĞ¾Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ Ñƒ Ğ²Ğ°Ñ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ - Ğ°Ñ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
# Ğ’ Ğ´Ğ°Ğ½Ğ½Ğ¾Ğ¼ ÑĞ»ÑƒÑ‡Ğ°Ğµ Ğ½ĞµÑ‚ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ° Ğ½Ğ° Ğ³ĞµÑ‚,Ğ¾Ğ½ Ğ¿Ğ¾ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ñ‚ĞµÑÑ‚Ğ°Ğ¼Ğ¸ Ğ¸Ğ· Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²
# ĞŸĞ»ÑÑÑ‹ Ğ´Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ° - Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞ¾ĞºÑ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ñ… ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸ĞµĞ² Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ÑŒ Ğ±Ğ¾Ğ»ĞµĞµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¹ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹
# Ğ¢Ğ°Ğº Ğ¶Ğµ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½Ğ¸Ñ‚ÑŒ Ğ´ĞµĞ»Ğ¸Ñ‚ Ğ¸ Ğ¿Ğ¾ÑÑ‚ Ğ½Ğ° Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ†ĞµĞ½Ğ½Ñ‹Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸
import random
import string

import pytest
import requests


def generate_random_string(N):
    return ''.join(random.choice(string.ascii_uppercase + string.digits) for _ in range(N))


class TestUserPostRequest:
    '''
    Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ POST Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
    '''

    def test_post_and_get_got_200(self):
        '''
        Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾ÑĞ»Ğ°Ğ» Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾ÑÑ‚, Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»Ğ¸ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· Ğ³ĞµÑ‚
        '''
        key = generate_random_string(20)
        value = generate_random_string(100)
        r = requests.post('http://flask_server:8000/dictionary', json={"key": key, "value": value})
        assert r.status_code == 200
        r = requests.get(f'http://flask_server:8000/dictionary/{key}')
        assert r.status_code == 200
        assert r.json()["key"] == key
        assert r.json()["value"] == value

    def test_post_got_409(self):
        '''
        Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾ÑĞ»Ğ°Ğ» Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾ÑÑ‚ Ğ¸ Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ ÑĞ½Ğ¾Ğ²Ğ° Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ» ÑĞ²Ğ¾Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ - ĞºĞ»ÑÑ‡ ÑƒĞ¶Ğµ ĞµÑÑ‚ÑŒ Ğ² Ğ±Ğ´, Ğ¼Ğ¾Ğ¶ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ³ĞµÑ‚
        '''
        key = generate_random_string(10)
        value = generate_random_string(10)
        r = requests.post('http://flask_server:8000/dictionary', json={"key": key, "value": value})
        assert r.status_code == 200
        r = requests.post('http://flask_server:8000/dictionary', json={"key": key, "value": value})
        assert r.status_code == 409
        r = requests.get(f'http://flask_server:8000/dictionary/{key}')
        assert r.status_code == 200
        assert r.json()["key"] == key
        assert r.json()["value"] == value

    @pytest.mark.parametrize("json", [
        {generate_random_string(10): generate_random_string(10), "value": generate_random_string(10)},
        None,
        {"key": generate_random_string(10), generate_random_string(10): generate_random_string(10)},
    ])
    def test_got_400(self, json):
        '''
        Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾ÑĞ»Ğ°Ğ» Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾ÑÑ‚ Ñ Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¼ ĞºĞ»ÑÑ‡ĞµĞ¼ key,Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¼ ĞºĞ»ÑÑ‡ĞµĞ¼ value Ğ¸ Ğ±ĞµĞ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
        '''
        r = requests.post('http://flask_server:8000/dictionary', json=json)
        assert r.status_code == 400

    @pytest.mark.parametrize("json", [
        {"key": generate_random_string(10), "value": generate_random_string(200)},
        {"key": generate_random_string(200), "value": generate_random_string(10)},
    ])
    def test_put_got_200_get_200(self, json):
        '''
        Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾ÑĞ»Ğ°Ğ» Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾ÑÑ‚ Ñ Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¼ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ¾Ğ¼ key,Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¼ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ¾Ğ¼ value
        Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½Ğ¸Ñ‚ÑŒ Ñ Ñ‚ĞµÑÑ‚Ğ¾Ğ¼ Ğ²Ñ‹ÑˆĞµ Ğ¾ÑĞ½Ğ¾Ğ²Ñ‹Ğ²Ğ°ÑÑÑŒ Ğ½Ğ° Ñ‚Ğ¾Ğ¼ Ñ‡Ñ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ğ¾ Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ
        '''
        r = requests.post('http://flask_server:8000/dictionary', json=json)
        assert r.status_code == 400
        r = requests.get(f'http://flask_server:8000/dictionary/{json["key"]}')
        if len(json["key"]) > 20:
            assert r.status_code == 400
        else:
            assert r.status_code == 404

    @pytest.mark.parametrize("json", [
        {"key": f"{generate_random_string(3)}á¹°ÌºÌºÌ•oÍnÌÌ—Í•ÌŸÌœÌ˜Ì¦ÍŸ", "value": generate_random_string(10)},
        {"key": generate_random_string(10), "value": "(ï½¡â—• âˆ€ â—•ï½¡)ğŸ™ˆÌÌ¥Ì±Ì³Ì­Í‰Í…cÌ¬ÌŸhÍ¡aÌ«Ì»Ì¯Í˜oÌ«ÌŸÌ–ÍÌ™ÌÍ‰sÌ—Ì¦Ì²"},
    ])
    def test_naughty_strings_post(self, json):
        '''
        Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾ÑĞ»Ğ°Ğ» json Ñ ÑÑ‚Ñ€Ğ¸Ğ½Ğ³Ğ°Ğ¼Ğ¸ Ğ¸Ğ· https://github.com/minimaxir/big-list-of-naughty-strings
        '''
        r = requests.post('http://flask_server:8000/dictionary', json=json)
        assert r.status_code == 200


class TestPutRequest:
    '''
    Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ PUT Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
    '''

    def test_put_got_200_get_200(self):
        '''
        Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ğ»Ğ¸ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ, Ğ¿Ñ€Ğ¾Ğ°Ğ¿Ğ´ĞµĞ¹Ñ‚Ğ¸Ğ»Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Ğ¿ÑƒÑ‚
        '''
        key = generate_random_string(10)
        value = generate_random_string(10)
        r = requests.post('http://flask_server:8000/dictionary', json={"key": key, "value": value})
        assert r.status_code == 200
        value2 = generate_random_string(10)
        r = requests.put(f'http://flask_server:8000/dictionary/{key}', json={"value": value2})
        assert r.status_code == 200
        r = requests.get(f'http://flask_server:8000/dictionary/{key}')
        assert r.status_code == 200
        assert r.json()["key"] == key
        assert r.json()["value"] == value2

    def test_put_got_404_get_404(self):
        '''
        Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ½ĞµÑ‚ Ğ² Ğ±Ğ´, Ğ¿Ñ€Ğ¾Ğ°Ğ¿Ğ´ĞµĞ¹Ñ‚Ğ¸Ğ»Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Ğ¿ÑƒÑ‚
        '''
        key = generate_random_string(10)
        value = generate_random_string(10)
        r = requests.put(f'http://flask_server:8000/dictionary/{key}', json={"value": value})
        assert r.status_code == 404
        r = requests.get(f'http://flask_server:8000/dictionary/{key}')
        assert r.status_code == 404

    def test_put_got_400_no_data(self):
        '''
        Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ ĞµÑÑ‚ÑŒ Ğ² Ğ±Ğ´, Ğ¿Ğ¾ÑĞ»Ğ°Ğ»Ğ¸ Ğ¿ÑƒÑ‚ Ğ±ĞµĞ· Ğ´Ğ°Ñ‚Ñ‹
        '''
        key = generate_random_string(10)
        value = generate_random_string(10)
        r = requests.post('http://flask_server:8000/dictionary', json={"key": key, "value": value})
        assert r.status_code == 200
        r = requests.put(f'http://flask_server:8000/dictionary/{key}')
        assert r.status_code == 400
        r = requests.get(f'http://flask_server:8000/dictionary/{key}')
        assert r.status_code == 200
        assert r.json()["key"] == key
        assert r.json()["value"] == value

    def test_abnormal_big_data(self):
        '''
        Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ ĞµÑÑ‚ÑŒ Ğ² Ğ±Ğ´, Ğ¿Ğ¾ÑĞ»Ğ°Ğ»Ğ¸ Ğ¿ÑƒÑ‚ Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ¼ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸ĞµĞ¼
        '''
        key = generate_random_string(10)
        value = generate_random_string(10)
        r = requests.post('http://flask_server:8000/dictionary', json={"key": key, "value": value})
        assert r.status_code == 200
        value2 = generate_random_string(101)
        r = requests.put(f'http://flask_server:8000/dictionary/{key}', json={"value": value2})
        assert r.status_code == 400
        r = requests.get(f'http://flask_server:8000/dictionary/{key}')
        assert r.status_code == 200
        assert r.json()["key"] == key
        assert r.json()["value"] == value

    def test_naughty_strings(self):
        '''
        Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ ĞµÑÑ‚ÑŒ Ğ² Ğ±Ğ´, Ğ¿Ğ¾ÑĞ»Ğ°Ğ»Ğ¸ Ğ¿ÑƒÑ‚ Ñ ÑÑ‚Ñ€Ğ¸Ğ½Ğ³Ğ°Ğ¼Ğ¸ Ğ¸Ğ· https://github.com/minimaxir/big-list-of-naughty-strings
        '''
        key = generate_random_string(10)
        value = generate_random_string(10)
        r = requests.post('http://flask_server:8000/dictionary', json={"key": key, "value": value})
        assert r.status_code == 200
        value2 = "(ï½¡â—• âˆ€ â—•ï½¡)ğŸ™ˆÌÌ¥Ì±Ì³Ì­Í‰Í…cÌ¬ÌŸhÍ¡aÌ«Ì»Ì¯Í˜oÌ«ÌŸÌ–ÍÌ™ÌÍ‰sÌ—Ì¦Ì²"
        r = requests.put(f'http://flask_server:8000/dictionary/{key}', json={"value": value2})
        r = requests.get(f'http://flask_server:8000/dictionary/{key}')
        assert r.status_code == 200
        assert r.json()["key"] == key
        assert r.json()["value"] == value2


class TestDeleteRequest:
    '''
    Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ DELETE Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
    '''

    def test_got_200_existing_key(self):
        '''
        Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ ĞµÑÑ‚ÑŒ Ğ² Ğ±Ğ´, ÑƒĞ´Ğ°Ğ»Ğ¸Ğ»Ğ¸,Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ğ»Ğ¸ Ñ‡Ñ‚Ğ¾ ÑƒĞ´Ğ°Ğ»Ğ¸Ğ»Ğ¾ÑÑŒ
        '''
        key = generate_random_string(10)
        value = generate_random_string(10)
        r = requests.delete(f'http://flask_server:8000/dictionary/{key}')
        assert r.status_code == 200
        r = requests.get(f'http://flask_server:8000/dictionary/{key}')
        assert r.status_code == 404

    def test_got_200_non_existing_key(self):
        '''
        Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Ğ½ĞµÑ‚ Ğ² Ğ±Ğ´, ÑƒĞ´Ğ°Ğ»Ğ¸Ğ»Ğ¸,Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ğ»Ğ¸ Ñ‡Ñ‚Ğ¾ ÑƒĞ´Ğ°Ğ»Ğ¸Ğ»Ğ¾ÑÑŒ
        '''
        key = generate_random_string(10)
        r = requests.delete(f'http://flask_server:8000/dictionary/{key}')
        assert r.status_code == 200
        r = requests.get(f'http://flask_server:8000/dictionary/{key}')
        assert r.status_code == 404
